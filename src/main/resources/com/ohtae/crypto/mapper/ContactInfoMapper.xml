<?xml version="1.0" encoding="UTF-8"?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ohtae.crypto.mapper.ContactInfoMapper">
    <select id="selectContactList" resultType="com.ohtae.crypto.data.ContactInfoVO">
        select 
            ci_seq,ci_mi_seq,ci_title,ci_contents,
            ci_reg_dt,ci_mod_dt,ci_status, mi_id
        from contact_info a join member_info b on a.ci_mi_seq = b.mi_seq 
        order by ci_mod_dt desc
        limit 20 offset #{offset} 
    </select>
    <select id="selectContactCounts" resultType="java.lang.Integer">
        select count(*) from contact_info 
    </select>
    <select id="selectContactInfo" resultType="com.ohtae.crypto.data.ContactInfoVO">
        select 
            ci_seq,ci_mi_seq,ci_title,ci_contents,
            ci_reg_dt,ci_mod_dt,ci_status, mi_id
        from contact_info a join member_info b on a.ci_mi_seq = b.mi_seq 
        where ci_seq = #{seq}
    </select>
    <select id="selectContactReplyInfo" resultType="com.ohtae.crypto.data.PostReplyInfoVO">
        select pri_seq,pri_contents,pri_reg_dt,pri_mi_seq,mi_id 
            from post_reply_info a join member_info b on a.pri_mi_seq = b.mi_seq
        where pri_pi_seq = #{seq}
    </select> 



    <insert id="insertContactHis">
        insert into contact_info_history(cih_ci_seq,cih_type,cih_content) values
         (#{cih_ci_seq},#{cih_type},#{cih_content})
    </insert>




    <update id="updateContactStatus">
        <if test="status == 1">
            update contact_info set ci_status = 2 where ci_seq = #{seq}
        </if>
        <if test="status == 2">
            update contact_info set ci_status = 1 where ci_seq = #{seq}
        </if>
    </update>





    <delete id="deleteContactInfo">
        delete from contact_info where ci_seq = #{seq}
    </delete>
    <delete id="deleteContactReplyInfo">
        delete from post_reply_info where pri_seq = #{seq}
    </delete>
</mapper>